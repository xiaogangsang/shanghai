{"version":3,"sources":["webpack:///webpack/bootstrap 1c6f78ee17aab47b0daa?707a******","webpack:///./src/js/banner.js","webpack:///./src/common/common.js?17e8******","webpack:///./bower_components/js-cookie/src/js.cookie.js?76a1******","webpack:///./bower_components/js-cookie/src/js.cookie.js?99a4*****"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;ACtCA,aAAY;;AAEZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW;;AAEX;AACA;AACA;AACA;AACA,UAAS;;AAET;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;;AAEH;AACA,EAAC;;AAED;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,IAAG;AACH,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA,wCAAuC,oCAAoC;AAC3E;AACA;AACA;AACA,MAAK;AACL,IAAG;AACH;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;;AAEH;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,QAAO;AACP;AACA;AACA,MAAK;AACL;;AAEA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;AACH,EAAC;;AAED;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oCAAmC;AACnC;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP,MAAK;AACL;AACA;AACA,IAAG;;AAEH;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL,IAAG;AACH,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,2EAA0E;AAC1E;;AAEA,QAAO;;AAEP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,MAAK;;AAEL;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,IAAG;;AAEH,eAAc;AACd;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,+JAA8J;AAC9J,MAAK;AACL;AACA;AACA;AACA;AACA,QAAO;AACP;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kJAAiJ;AACjJ,QAAO;;AAEP;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;AACH,EAAC;;AAED;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;;AAEA,OAAM;AACN;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA,aAAY;AACZ;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA;AACA,MAAK;AACL;AACA;AACA;AACA,IAAG;AACH,aAAY;AACZ;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,uBAAsB,yBAAyB;AAC/C,QAAO;AACP,MAAK;AACL;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA,MAAK;AACL;AACA;AACA,IAAG;AACH;;AAEA;AACA,eAAc;AACd;AACA;AACA;AACA;AACA;;AAEA;AACA,eAAc;AACd;AACA;AACA;AACA;AACA;;;;;;;ACntBA,aAAY;;AAEZ;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yPAAwP;AACxP;AACA,MAAK;AACL,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,kBAAiB,iBAAiB;AAClC;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;;;;;;;ACzHA,2G;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA,GAAE;AACF;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA,SAAQ,sBAAsB;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,eAAc;AACd;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,8BAA6B;AAC7B,8BAA6B;AAC7B,8BAA6B;AAC7B,4BAA2B;AAC3B;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,4DAA2D;AAC3D,8BAA6B,EAAE;AAC/B;;AAEA,UAAS,oBAAoB;AAC7B;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAO;AACP;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;;AAEA;;AAEA;AACA;;AAEA,4BAA2B;AAC3B,EAAC","file":"banner.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/Users/liuge/Workspace/moviesys/dist/js/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 1c6f78ee17aab47b0daa\n **/","'use strict;'\n\nvar common = require('common');\nvar _channels = {};\nvar _cities = [];\nvar _choosed = [];\nvar _movies = {};\nvar _pageIndex = 1;\nvar _pageSize = 10;\nvar _pageTotal = 0;\nvar _querying = false;\nvar searchCache = {};\nvar useCache = false;\nvar dataCache;\nvar _submitting = false;\nvar _provinces = [];\n\n// var _cityAuthority = sessionStorage.getItem('cityAuthority').split(',');\n\n$(function () {\n  common.init('banner');\n\n  //set search form\n  setChannel();\n  setProvince();\n\n  $('#search_startTime').datetimepicker({\n    format: 'yyyy-mm-dd',\n    language: 'zh-CN',\n    minView: 2,\n    todayHighlight: true,\n    autoclose: true,\n  }).on('changeDate', function (ev) {\n    var startDate = new Date(ev.date.valueOf());\n    startDate.setDate(startDate.getDate(new Date(ev.date.valueOf())));\n    $('#search_endTime').datetimepicker('setStartDate', startDate);\n  });\n\n  $('#search_endTime').datetimepicker({\n    format: 'yyyy-mm-dd',\n    language: 'zh-CN',\n    minView: 2,\n    todayHighlight: true,\n    autoclose: true,\n  }).on('changeDate', function (ev) {\n    var FromEndDate = new Date(ev.date.valueOf());\n    FromEndDate.setDate(FromEndDate.getDate(new Date(ev.date.valueOf())));\n    $('#search_startTime').datetimepicker('setEndDate', FromEndDate);\n  });\n\n  var beginDate = new Date();\n  var endDate = new Date();\n  beginDate.setDate(beginDate.getDate() - 7);\n  beginDate = common.getDate(beginDate);\n  endDate = common.getDate(endDate);\n  $('#search_startTime').val(beginDate).datetimepicker('setEndDate', endDate);\n  $('#search_endTime').val(endDate).datetimepicker('setStartDate', beginDate);\n\n  //data cache\n  getCity();\n  getMovie();\n\n  $('#formSearch').trigger('submit');\n});\n\n//handle search form\n$('#formSearch').on('click', 'button[type=submit]', function (event) {\n  event.preventDefault();\n  _pageIndex = 1;\n  useCache = false;\n  $('#formSearch').trigger('submit');\n});\n\n$('#formSearch').on('submit', function (e) {\n  e.preventDefault();\n  var sendData = {\n    bannerName: $.trim($('#search_bannerName').val()),\n    bannerType: $('#search_bannerType').val(),\n    channelId: $('#search_channelId').val(),\n    startTime: $('#search_startTime').val(),\n    endTime: $('#search_endTime').val(),\n    cityId: $('#search_cityId').val(),\n    pageSize: _pageSize,\n  };\n  if (!!_querying) {\n    return false;\n  }\n\n  _querying = true;\n  if (useCache) {\n    sendData = searchCache;\n  } else {\n    searchCache = sendData;\n  }\n\n  sendData.pageIndex = _pageIndex;\n\n  $.ajax({\n    url: common.API_HOST + 'banner/bannerList',\n    type: 'POST',\n    dataType: 'json',\n    data: sendData,\n  })\n  .done(function (res) {\n    _querying = false;\n    if (!!~~res.meta.result) {\n      if (res.data.rows.length < 1) {\n        $('#dataTable tbody').html('<tr><td colspan=\"9\" align=\"center\">查不到相关数据，请修改查询条件！</td></tr>');\n        $('#pager').html('');\n      } else {\n        useCache = true;\n        _pageIndex = res.data.pageIndex;\n        _pageTotal = Math.ceil(res.data.total / _pageSize);\n        setPager(res.data.total, _pageIndex, res.data.rows.length, _pageTotal);\n        _(res.data.rows).forEach(function (item) {\n          _(_channels).forEach(function (channel, key) {\n            if (channel.channelId == item.channelId) {\n              item.channelName = channel.channelName;\n            }\n          });\n\n          item.bannerTypeName = item.bannerType == 1 ? '首页' : '热门影片';\n          item.statusName = item.status == 1 ? '是' : '否';\n          item.startTime = item.startTime.split(' ')[0];\n          item.endTime = item.endTime.split(' ')[0];\n        });\n\n        dataCache = res.data.rows;\n        setTableData(dataCache);\n      }\n    } else {\n      alert('接口错误：' + res.meta.msg);\n    }\n  });\n\n  return false;\n});\n\n$(document).on('click', '#btn-create', function (e) {\n  _choosed = [];\n  setModal(false);\n  $('#popup-banner-form').modal('show');\n\n  $('#startTime').datetimepicker({\n    format: 'yyyy-mm-dd',\n    language: 'zh-CN',\n    minView: 2,\n    todayHighlight: true,\n    autoclose: true,\n  }).on('changeDate', function (ev) {\n    var startDate = new Date(ev.date.valueOf());\n    startDate.setDate(startDate.getDate(new Date(ev.date.valueOf())));\n    $('#endTime').datetimepicker('setStartDate', startDate);\n  });\n\n  $('#endTime').datetimepicker({\n    format: 'yyyy-mm-dd',\n    language: 'zh-CN',\n    minView: 2,\n    todayHighlight: true,\n    autoclose: true,\n  }).on('changeDate', function (ev) {\n    var FromEndDate = new Date(ev.date.valueOf());\n    FromEndDate.setDate(FromEndDate.getDate(new Date(ev.date.valueOf())));\n    $('#startTime').datetimepicker('setEndDate', FromEndDate);\n  });\n\n  $('#popup-banner-form form').parsley();\n  $('#popup-banner-form #filmId').chosen();\n\n  $('#popup-banner-form').on('change', '#bannerType', function (event) {\n    event.preventDefault();\n    if ($(this).val() == 1) {\n      $('.type-2, .type-3').hide();\n      $('.type-2, .type-3').find('input,select').prop('required', false);\n      $('.type-1').show();\n      $('.type-1').find('input,select').prop('required', true);\n    } else if ($(this).val() == 2) {\n      $('.type-1, .type-3').hide();\n      $('.type-1, .type-3').find('input,select').prop('required', false);\n      $('.type-2').show();\n      $('.type-2').find('input,select').prop('required', true);\n    } else {\n      $('.type-1, .type-2').hide();\n      $('.type-1, .type-2').find('input,select').prop('required', false);\n      $('.type-3').show();\n      $('.type-3').find('input,select').prop('required', true);\n    }\n\n    $('.chosen-search input').prop('required', false);\n    $('#popup-banner-form form').parsley().reset();\n  });\n});\n\n$(document).on('change', '#search_provinceId', function (e) {\n  e.preventDefault();\n  var provinceId = parseInt($(this).val());\n  var options = '';\n  if (!!+provinceId) {\n    var province = _.find(_provinces, { provinceId: provinceId.toString() });\n    var cityList = province.cityList;\n    _(cityList).forEach(function (value, key) {\n      options += '<option value=\"' + value.cityId + '\">' + value.cityName + '</option>';\n    });\n  } else {\n    options = '<option value=\"\">全国</option>';\n  }\n\n  $('#search_cityId').html(options);\n  return false;\n});\n\n$(document).on('change', 'input[name=areaType]', function (e) {\n  e.preventDefault();\n  if (!!~~$('input[name=areaType]:checked').val()) {\n    $('#btn-city').closest('tr').show();\n  } else {\n    $('#btn-city').closest('tr').hide();\n  }\n});\n\n$('#dataTable').on('click', '.btn-edit', function (e) {\n  e.preventDefault();\n  var id = $(this).closest('tr').data('id');\n  var banner;\n  _(dataCache).forEach(function (item) {\n    if (item.id == id) {\n      banner = item;\n    }\n  });\n\n  _(_channels).forEach(function (channel) {\n    channel.selected = banner.channelId == channel.channelId ? true : false;\n  });\n\n  _choosed = banner.cityList != null ? banner.cityList : [];\n  setModal(banner);\n  $('#popup-banner-form').modal('show');\n  $('#startTime').datetimepicker({\n    format: 'yyyy-mm-dd',\n    language: 'zh-CN',\n    minView: 2,\n    todayHighlight: true,\n    autoclose: true,\n  }).on('changeDate', function (ev) {\n    var startDate = new Date(ev.date.valueOf());\n    startDate.setDate(startDate.getDate(new Date(ev.date.valueOf())));\n    $('#endTime').datetimepicker('setStartDate', startDate);\n  });\n\n  $('#endTime').datetimepicker({\n    format: 'yyyy-mm-dd',\n    language: 'zh-CN',\n    minView: 2,\n    todayHighlight: true,\n    autoclose: true,\n  }).on('changeDate', function (ev) {\n    var FromEndDate = new Date(ev.date.valueOf());\n    FromEndDate.setDate(FromEndDate.getDate(new Date(ev.date.valueOf())));\n    $('#startTime').datetimepicker('setEndDate', FromEndDate);\n  });\n\n  $('#popup-banner-form form').parsley();\n});\n\n$('#dataTable').on('click', '.btn-delete', function (e) {\n  e.preventDefault();\n  var that = $(this).parents('tr');\n  if (window.confirm('确定要删除此banner吗？')) {\n    $.ajax({\n      url: common.API_HOST + 'banner/deleteBanner',\n      type: 'POST',\n      dataType: 'json',\n      data: {\n        id: that.data('id'),\n        bannerType: that.data('bannertype'),\n      },\n    })\n    .done(function (res) {\n      if (!!~~res.meta.result) {\n        alert('删除成功！');\n        that.fadeOut(500, function () {\n          that.remove();\n        });\n      } else {\n        alert('接口错误：' + res.meta.msg);\n      }\n    });\n  }\n\n  return false;\n});\n\n$(document).on('submit', '#popup-city form', function (event) {\n  event.preventDefault();\n  var choosedCity = [];\n  $('.choosed-city .label').each(function () {\n    choosedCity.push($(this).data('id'));\n  });\n\n  _choosed = choosedCity;\n  $('#popup-city').modal('hide');\n});\n\n$('#dataTable').on('click', '.btn-status', function (event) {\n  event.preventDefault();\n  var tr = $(this).closest('tr');\n  var sendData = {\n    id: tr.data('id'),\n    bannerType: tr.data('bannertype'),\n    status: $(this).data('status') == 1 ? 0 : 1,\n  };\n  var statusName = sendData.status ? '上线' : '下线';\n  $.ajax({\n    url: common.API_HOST + 'banner/updateBannerStatus',\n    type: 'POST',\n    dataType: 'json',\n    data: sendData,\n  })\n  .done(function (res) {\n    if (!!~~res.meta.result) {\n      tr.find('.btn-status').data('status', sendData.status).html(sendData.status ? '下线' : '上线');\n      tr.children('td:nth-child(6)').html(sendData.status ? '是' : '否');\n      alert(statusName + '操作成功!');\n      $('#formSearch').trigger('submit');\n    } else {\n      alert('接口错误：' + res.meta.msg);\n    }\n  });\n});\n\n$(document).on('submit', '#popup-banner-form form', function (event) {\n  event.preventDefault();\n  if (_submitting) {\n    return false;\n  }\n\n  if (!!~~$('input[name=areaType]:checked').val() && _choosed.length < 1) {\n    alert('区域类型的banner，必须选择城市！');\n    return false;\n  }\n\n  _submitting = true;\n  var sendData = {\n    bannerType: ~~$('#popup-banner-form #bannerType').val(),\n    bannerName: $.trim($('#popup-banner-form #bannerName').val()),\n    channelId: ~~$('#popup-banner-form #channelId').val(),\n    status: ~~$('#popup-banner-form #status').val(),\n    startTime: $.trim($('#popup-banner-form #startTime').val()),\n    endTime: $.trim($('#popup-banner-form #endTime').val()),\n  };\n\n  if (sendData.bannerType == 1 || sendData.bannerType == 2) {\n    sendData.position = ~~$.trim($('#popup-banner-form #position').val());\n    sendData.areaType = ~~$('input[name=areaType]:checked').val();\n    sendData.cityList = [];\n    if (sendData.areaType == 1) {\n      sendData.cityList = _choosed;\n      if (sendData.cityList.length < 1) {\n        alert('区域类型的banenr，必须选择城市！');\n        return false;\n      }\n    }\n  }\n\n  if (sendData.bannerType == 1 || sendData.bannerType == 3) {\n    sendData.imageUrl = $('#popup-banner-form #imageUrl').val();\n    sendData.link = $('#popup-banner-form #link').val();\n  }\n\n  if (sendData.bannerType == 2) {\n    sendData.filmId = $('#popup-banner-form #filmId').val();\n  }\n\n  var ajaxUrl = common.API_HOST + 'banner/saveBanner';\n  if ($('#popup-banner-form #id').length > 0) {\n    sendData.id = $('#popup-banner-form #id').val();\n    ajaxUrl = common.API_HOST + 'banner/updateBanner';\n  }\n\n  $.ajax({\n    url: ajaxUrl,\n    type: 'POST',\n    dataType: 'json',\n    contentType: 'application/json; charset=utf-8',\n    data: JSON.stringify(sendData),\n  })\n  .done(function (res) {\n    _submitting = false;\n    if (!!~~res.meta.result) {\n      if ($('#popup-banner-form #id').length > 0) {\n        alert('更新成功！');\n      } else {\n        alert('添加成功！');\n      }\n\n      $('#popup-banner-form').modal('hide');\n      $('#formSearch').trigger('submit');\n      _choosed = [];\n      _(_cities).forEach(function (city) {\n        city.selected = false;\n      });\n    } else {\n      alert('接口错误：' + res.meta.msg);\n    }\n  });\n\n  return false;\n});\n\n$(document).on('click', '#popup-banner-form #btn-upload', function (event) {\n  event.preventDefault();\n  $('#fileupload').next('span').remove();\n  $('#popup-banner-upload').modal('show');\n  $('#fileupload').data('url', common.API_HOST + 'banner/uploadPic').fileupload({\n    dataType: 'json',\n    add: function (e, data) {\n      $('#fileupload').next('span').remove();\n      $('#fileupload').after(' <span>' + data.files[0].name + '</span>');\n      $('#popup-banner-upload button.btn-primary').off('click').on('click', function () {\n        $(this).prop('disable', true).text('上传中...');\n        data.submit();\n      });\n    },\n\n    done: function (e, data) {\n      $('#popup-banner-upload button.btn-primary').prop('disable', false).text('上传');\n      if (!!~~data.result.meta.result) {\n        $('#imageUrl').val(data.result.data.savePath);\n        alert('上传成功！');\n        $('#popup-banner-upload').modal('hide');\n      } else {\n        alert('上传失败：' + data.result.meta.msg);\n      }\n    },\n  });\n});\n\n$(document).on('click', '#popup-banner-form #btn-city', function (event) {\n  event.preventDefault();\n  var htmlChoosed = '';\n  var htmlTab = '';\n  var htmlPane = '';\n  var tabCount = 1;\n  var htmlGroup;\n  var index = 1;\n  var total = _cities.length;\n  _(_cities).forEach(function (group) {\n    if (index % 5 == 1) {\n      htmlTab += '<li>'\n      + '<a href=\"#section-' + index + '\" aria-controls=\"section-' + index\n      + '\" role=\"tab\" data-toggle=\"tab\">';\n      htmlPane += '<div role=\"tabpanel\" class=\"tab-pane\" id=\"section-' + index + '\">';\n    }\n\n    htmlTab += group.key + ' ';\n    htmlGroup = '<div class=\"input-group\"><div class=\"input-group-addon\">' + group.key + '</div>';\n    _(group.group).forEach(function (city, key) {\n      if (_choosed.indexOf(city.cityId) > -1) {\n\n        // if (_cityAuthority.indexOf('' + city.cityId) > -1) {\n        htmlGroup += '<label>';\n        htmlGroup += '<input type=\"checkbox\" value=\"' + city.cityId + '\" checked>';\n        htmlGroup += '<span>' + city.cityName + '</span>';\n        htmlGroup += '</label>';\n\n        // }\n\n        htmlChoosed += '<span class=\"label label-default\" data-id=\"' + city.cityId + '\">';\n        htmlChoosed += city.cityName;\n        htmlChoosed += ' <button type=\"button\" class=\"close\"><span>&times;</span></button>';\n        htmlChoosed += '</span>';\n\n      } else {\n\n        // if (_cityAuthority.indexOf('' + city.cityId) > -1) {\n        htmlGroup += '<label>';\n        htmlGroup += '<input type=\"checkbox\" value=\"' + city.cityId + '\">';\n        htmlGroup += '<span>' + city.cityName + '</span>';\n        htmlGroup += '</label>';\n\n        // }\n      }\n    });\n\n    htmlGroup += '</div>';\n\n    htmlPane += htmlGroup;\n\n    if (index % 5 == 0 || index == total) {\n      htmlTab += '</a></li>';\n      htmlPane += '</div>';\n      tabCount++;\n    }\n\n    index++;\n  });\n\n  var data = { choosed: htmlChoosed, tab: htmlTab, pane: htmlPane };\n  var template = $('#city-template').html();\n  Mustache.parse(template);\n  var html = Mustache.render(template, data);\n  $('#popup-city .modal-body').html(html);\n  $('#popup-city .nav-tabs li:first-child a').trigger('click');\n  $('#popup-city').modal('show');\n\n  $('.candidate-city').on('change', 'input[type=checkbox]', function (event) {\n    event.preventDefault();\n    var cityId = $(this).val();\n    var cityName = $(this).next('span').text();\n    if ($(this).prop('checked')) {\n      $('.choosed-city').append('<span class=\"label label-default\" data-id=\"' + cityId + '\">' + cityName + ' <button type=\"button\" class=\"close\"><span>&times;</span></button></span>');\n    } else {\n      $('.choosed-city .label').each(function () {\n        if ($(this).data('id') == cityId) {\n          $(this).remove();\n        }\n      });\n    }\n  });\n\n  $('#popup-city').on('change', '#chooseAll', function (event) {\n    event.preventDefault();\n    $('.choosed-city .label').remove();\n    if (!!$(this).prop('checked')) {\n      var choosed = '';\n      $('.candidate-city input[type=checkbox]').each(function () {\n        var cityId = $(this).val();\n        var cityName = $(this).next('span').text();\n        choosed += '<span class=\"label label-default\" data-id=\"' + cityId + '\">' + cityName + ' <button type=\"button\" class=\"close\"><span>&times;</span></button></span>';\n      });\n\n      $('.candidate-city input[type=checkbox]').prop('checked', true);\n      $('.choosed-city').append(choosed);\n    } else {\n      $('.candidate-city input[type=checkbox]').prop('checked', false);\n    }\n  });\n});\n\n$(document).on('click', '#popup-city .choosed-city>.label>.close', function (event) {\n  event.preventDefault();\n  var $label = $(this).closest('.label');\n  var cityId = $label.data('id');\n\n  // if (_cityAuthority.indexOf('' + cityId) > -1) {\n  $('.candidate-city input:checked').each(function (index, el) {\n    if ($(el).val() == cityId) {\n      $(el).prop('checked', false);\n    }\n  });\n\n  $label.remove();\n\n  // } else {\n  //   alert('没有权限！');\n  // }\n});\n\nfunction setModal(bannerData) {\n  var data;\n  var template;\n  var html;\n  if (bannerData) {\n    data = { banner: bannerData, channels: _channels };\n    if (bannerData.bannerType == 1) {\n      template = $('#index-template').html();\n      $('#popup-banner-form .modal-title').html('编辑[首页]Banner');\n    } else if (bannerData.bannerType == 2) {\n      data.movies = _movies;\n      _(_movies).forEach(function (movie) {\n        if (movie.filmId == bannerData.filmId) {\n          data.banner.filmName = movie.filmName;\n        }\n      });\n\n      template = $('#movie-template').html();\n      $('#popup-banner-form .modal-title').html('编辑[热门影片]Banner');\n    } else {\n      template = $('#salling-template').html();\n      $('#popup-banner-form .modal-title').html('编辑[交叉销售]Banner');\n    }\n  } else {\n    data = { movies: _movies, channels: _channels };\n    template = $('#create-template').html();\n    $('#popup-banner-form .modal-title').html('新建Banner');\n  }\n\n  Mustache.parse(template);\n  html = Mustache.render(template, data);\n  $('#popup-banner-form .modal-body').html(html);\n  return false;\n}\n\n$('#pager').on('click', '.prev,.next', function (e) {\n  e.preventDefault();\n  if ($(this).hasClass('prev')) {\n    if (_pageIndex <= 1) {\n      _pageIndex = 1;\n      alert('已经是第一页！');\n      return false;\n    }\n\n    _pageIndex--;\n  } else {\n    if (_pageIndex >= _pageTotal) {\n      _pageIndex = _pageTotal;\n      alert('已经是最后一页！');\n      return false;\n    }\n\n    _pageIndex++;\n  }\n\n  $('#formSearch').trigger('submit');\n  return false;\n});\n\n$('#formSearch').on('click', 'button[type=submit]', function (event) {\n  event.preventDefault();\n  _pageIndex = 1;\n  useCache = false;\n  $('#formSearch').trigger('submit');\n});\n\n$('#pager').on('click', '#btn-pager', function (e) {\n  e.preventDefault();\n  if (!!~~$('#pageNo').val()) {\n    return false;\n  }\n\n  var pageNo = parseInt($('#pageNo').val());\n  if (NaN == pageNo || pageNo < 1 || pageNo > _pageTotal) {\n    alert('要跳转的页码超过了范围！');\n    return false;\n  }\n\n  _pageIndex = pageNo;\n  $('#formSearch').trigger('submit');\n  return false;\n});\n\nfunction setChannel() {\n  $.ajax({\n    url: common.API_HOST + 'common/channelList',\n    type: 'GET',\n    dataType: 'json',\n  })\n  .done(function (res) {\n    if (!!~~res.meta.result) {\n      _channels = res.data;\n      $.each(_channels, function (index, item) {\n        $('#search_channelId').append($('<option></option>').attr('value', item.channelId).text(item.channelName));\n      });\n    }\n  });\n}\n\nfunction getMovie() {\n  $.ajax({\n    url: common.API_HOST + 'common/filmList',\n    type: 'GET',\n    dataType: 'json',\n  })\n  .done(function (res) {\n    if (!!~~res.meta.result) {\n      _movies = res.data;\n    }\n  });\n}\n\nfunction getCity() {\n  $.ajax({\n    url: common.API_HOST + 'common/cityList',\n    type: 'GET',\n    dataType: 'json',\n  })\n  .done(function (res) {\n    if (!!~~res.meta.result) {\n      _(res.data).forEach(function (group, key) {\n        _cities.push({ key: key, group: group });\n      });\n    } else {\n      alert('接口错误：' + res.meta.msg);\n    }\n  });\n}\n\nfunction setProvince() {\n  $.ajax({\n    url: common.API_HOST + 'common/provinceList',\n    type: 'GET',\n    dataType: 'json',\n  })\n  .done(function (res) {\n    if (!!~~res.meta.result) {\n      _provinces = res.data;\n      var html = '';\n      _(_provinces).forEach(function (province) {\n        html += '<option value=\"' + province.provinceId + '\">' + province.provinceName + '</option>';\n      });\n\n      $('#search_provinceId').append(html);\n    } else {\n      alert('接口错误：' + res.meta.msg);\n    }\n  });\n}\n\nfunction setTableData(rows) {\n  var data = { rows: rows };\n  var template = $('#table-template').html();\n  Mustache.parse(template);\n  var html = Mustache.render(template, data);\n  $('#dataTable tbody').html(html);\n}\n\nfunction setPager(total, pageIndex, rowsSize, pageTotal) {\n  var data = { total: total, pageIndex: pageIndex, rowsSize: rowsSize, pageTotal: pageTotal };\n  var template = $('#pager-template').html();\n  Mustache.parse(template);\n  var html = Mustache.render(template, data);\n  $('#pager').html(html);\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/js/banner.js\n ** module id = 0\n ** module chunks = 13\n **/","'use strict;'\n\nrequire('cookie');\nvar common = {};\n\ncommon.API_HOST = window.location.protocol + '//' + window.location.host + '/MovieOps/';\n\ncommon.init = function (pageName) {\n  common.checkLogin();\n  common.showMenu(pageName);\n  common.setLoginName();\n\n  $.ajaxSetup({\n    error: function (jqXHR, textStatus, errorThrown) {\n      var errorMsg = jqXHR.status + '：未知错误！';\n      var redirectUrl = document.location.href;\n      switch (jqXHR.status){\n        case (500):\n          errorMsg = jqXHR.status + '：服务器无响应，请稍后再试！';\n        break;\n        case (401):\n          errorMsg = jqXHR.status + '：未登录或登陆超时，请尝试重新登陆！';\n          redirectUrl = 'login.html?logout';\n        break;\n        case (403):\n          errorMsg = jqXHR.status + '：没有权限，请尝试重新登陆！';\n          redirectUrl = 'login.html?logout';\n        break;\n        case (404):\n          errorMsg = jqXHR.status + '：服务器暂时无法访问，请稍后再试！';\n        break;\n        case (408):\n          errorMsg = jqXHR.status + '：请求超时，请稍后再试！';\n        break;\n        case (0):\n          errorMsg = jqXHR.status + '：貌似断网了！';\n        break;\n      }\n      $('<div class=\"modal fade\" data-keyboard=\"false\" data-backdrop=\"static\"><div class=\"modal-dialog\"><div class=\"modal-content\"><div class=\"modal-header\"><h4 class=\"modal-title\">错误提示</h4></div><div class=\"modal-body\"><p style=\"text-align:center;\">' + errorMsg + '</p></div><div class=\"modal-footer\"><a href=\"' + redirectUrl + '\" class=\"btn btn-primary\">确定</a></div></div></div></div>').appendTo('body').modal('show');\n      throw new Error('Abort, error ' + jqXHR.status);\n    },\n  });\n};\n\ncommon.showMenu = function (pageName) {\n  var allowMenus = sessionStorage.getItem('menuAuthority') != null ? sessionStorage.getItem('menuAuthority').split(',') : null;\n  if (pageName != undefined && pageName != '' && $('#menu-' + pageName).size() > 0) {\n    var menuId = '' + $('#menu-' + pageName).data('id');\n    if (allowMenus.indexOf(menuId) < 0) {\n      common.logout();\n      window.location.href = 'login.html';\n    }\n\n    $('#menu-' + pageName).addClass('active').closest('.panel-collapse').collapse('show');\n\n  }\n\n  var $menus = $('#menu .list-group-item');\n  $menus.each(function (index, el) {\n    menuId = '' + $(el).data('id');\n    if (allowMenus.indexOf(menuId) > -1) {\n      $(el).show();\n      $(el).closest('.panel').show();\n    }\n  });\n};\n\ncommon.checkLogin = function () {\n  if (sessionStorage.getItem('menuAuthority') == null || Cookies.get('Xtoken') == undefined) {\n    common.logout();\n    window.location.href = 'login.html';\n  }\n};\n\ncommon.setLoginName = function () {\n  var loginName = Cookies.get('name');\n  if (loginName != undefined && loginName != '') {\n    $('#loginName').text(loginName);\n  }\n};\n\ncommon.logout = function () {\n  Cookies.remove('Xtoken');\n  Cookies.remove('name');\n  sessionStorage.setItem('cityAuthority', '');\n  sessionStorage.setItem('channelAuthority', '');\n  sessionStorage.setItem('menuAuthority', '');\n};\n\ncommon.getDate = function (date) {\n  if (date == undefined || date == '') {\n    date = new Date();\n  }\n\n  var YYYY = date.getFullYear().toString();\n  var MM = (date.getMonth() + 1).toString();\n  var DD = date.getDate().toString();\n  MM = MM[1] ? MM : '0' + MM[0];\n  DD = DD[1] ? DD : '0' + DD[0];\n  return YYYY + '-' + MM + '-' + DD;\n};\n\ncommon.getUrlParam = function () {\n  var paramArr = {};\n  var query = window.location.search.substring(1);\n  var vars = query.split('&');\n  for (var i = 0; i < vars.length; i++) {\n    var pair = vars[i].split(/=(.+)?/);\n    if (typeof paramArr[pair[0]] === 'undefined') {\n      paramArr[pair[0]] = decodeURIComponent(pair[1]);\n    } else if (typeof paramArr[pair[0]] === 'string') {\n      var arr = [paramArr[pair[0]], decodeURIComponent(pair[1])];\n      paramArr[pair[0]] = arr;\n    } else {\n      paramArr[pair[0]].push(decodeURIComponent(pair[1]));\n    }\n  }\n\n  return paramArr;\n};\n\nmodule.exports = common;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/common/common.js\n ** module id = 1\n ** module chunks = 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46\n **/","module.exports = global[\"Cookies\"] = require(\"-!/Users/liuge/Workspace/moviesys/bower_components/js-cookie/src/js.cookie.js\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./bower_components/js-cookie/src/js.cookie.js\n ** module id = 2\n ** module chunks = 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46\n **/","/*!\n * JavaScript Cookie v2.1.1\n * https://github.com/js-cookie/js-cookie\n *\n * Copyright 2006, 2015 Klaus Hartl & Fagner Brack\n * Released under the MIT license\n */\n;(function (factory) {\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(factory);\n\t} else if (typeof exports === 'object') {\n\t\tmodule.exports = factory();\n\t} else {\n\t\tvar OldCookies = window.Cookies;\n\t\tvar api = window.Cookies = factory();\n\t\tapi.noConflict = function () {\n\t\t\twindow.Cookies = OldCookies;\n\t\t\treturn api;\n\t\t};\n\t}\n}(function () {\n\tfunction extend () {\n\t\tvar i = 0;\n\t\tvar result = {};\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tvar attributes = arguments[ i ];\n\t\t\tfor (var key in attributes) {\n\t\t\t\tresult[key] = attributes[key];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction init (converter) {\n\t\tfunction api (key, value, attributes) {\n\t\t\tvar result;\n\t\t\tif (typeof document === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Write\n\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tattributes = extend({\n\t\t\t\t\tpath: '/'\n\t\t\t\t}, api.defaults, attributes);\n\n\t\t\t\tif (typeof attributes.expires === 'number') {\n\t\t\t\t\tvar expires = new Date();\n\t\t\t\t\texpires.setMilliseconds(expires.getMilliseconds() + attributes.expires * 864e+5);\n\t\t\t\t\tattributes.expires = expires;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tresult = JSON.stringify(value);\n\t\t\t\t\tif (/^[\\{\\[]/.test(result)) {\n\t\t\t\t\t\tvalue = result;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\n\t\t\t\tif (!converter.write) {\n\t\t\t\t\tvalue = encodeURIComponent(String(value))\n\t\t\t\t\t\t.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = converter.write(value, key);\n\t\t\t\t}\n\n\t\t\t\tkey = encodeURIComponent(String(key));\n\t\t\t\tkey = key.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent);\n\t\t\t\tkey = key.replace(/[\\(\\)]/g, escape);\n\n\t\t\t\treturn (document.cookie = [\n\t\t\t\t\tkey, '=', value,\n\t\t\t\t\tattributes.expires && '; expires=' + attributes.expires.toUTCString(), // use expires attribute, max-age is not supported by IE\n\t\t\t\t\tattributes.path    && '; path=' + attributes.path,\n\t\t\t\t\tattributes.domain  && '; domain=' + attributes.domain,\n\t\t\t\t\tattributes.secure ? '; secure' : ''\n\t\t\t\t].join(''));\n\t\t\t}\n\n\t\t\t// Read\n\n\t\t\tif (!key) {\n\t\t\t\tresult = {};\n\t\t\t}\n\n\t\t\t// To prevent the for loop in the first place assign an empty array\n\t\t\t// in case there are no cookies at all. Also prevents odd result when\n\t\t\t// calling \"get()\"\n\t\t\tvar cookies = document.cookie ? document.cookie.split('; ') : [];\n\t\t\tvar rdecode = /(%[0-9A-Z]{2})+/g;\n\t\t\tvar i = 0;\n\n\t\t\tfor (; i < cookies.length; i++) {\n\t\t\t\tvar parts = cookies[i].split('=');\n\t\t\t\tvar name = parts[0].replace(rdecode, decodeURIComponent);\n\t\t\t\tvar cookie = parts.slice(1).join('=');\n\n\t\t\t\tif (cookie.charAt(0) === '\"') {\n\t\t\t\t\tcookie = cookie.slice(1, -1);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tcookie = converter.read ?\n\t\t\t\t\t\tconverter.read(cookie, name) : converter(cookie, name) ||\n\t\t\t\t\t\tcookie.replace(rdecode, decodeURIComponent);\n\n\t\t\t\t\tif (this.json) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcookie = JSON.parse(cookie);\n\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === name) {\n\t\t\t\t\t\tresult = cookie;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!key) {\n\t\t\t\t\t\tresult[name] = cookie;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tapi.set = api;\n\t\tapi.get = function (key) {\n\t\t\treturn api(key);\n\t\t};\n\t\tapi.getJSON = function () {\n\t\t\treturn api.apply({\n\t\t\t\tjson: true\n\t\t\t}, [].slice.call(arguments));\n\t\t};\n\t\tapi.defaults = {};\n\n\t\tapi.remove = function (key, attributes) {\n\t\t\tapi(key, '', extend(attributes, {\n\t\t\t\texpires: -1\n\t\t\t}));\n\t\t};\n\n\t\tapi.withConverter = init;\n\n\t\treturn api;\n\t}\n\n\treturn init(function () {});\n}));\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./bower_components/js-cookie/src/js.cookie.js\n ** module id = 3\n ** module chunks = 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46\n **/"],"sourceRoot":""}