{"version":3,"sources":["webpack:///webpack/bootstrap 1c6f78ee17aab47b0daa?707a******************","webpack:///./src/js/coupon-rule-edit.js","webpack:///./src/common/common.js?17e8******************","webpack:///./bower_components/js-cookie/src/js.cookie.js?76a1******************","webpack:///./bower_components/js-cookie/src/js.cookie.js?99a4*****************"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;ACtCA,aAAY;;AAEZ;AACA;AACA;AACA;AACA;AACA,EAAC,aAAa;AACd,EAAC,aAAa;AACd;AACA;AACA,EAAC,aAAa;AACd,EAAC,eAAe;AAChB,EAAC,eAAe;AAChB,EAAC,aAAa;AACd;AACA;AACA,EAAC,aAAa;AACd,EAAC,aAAa;AACd,EAAC,aAAa;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA,MAAK;AACL,IAAG;;AAEH,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA,QAAO;;AAEP;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL,IAAG;AACH,EAAC;;AAED;AACA;AACA;AACA;AACA,eAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA,iFAAgF,wBAAwB;AACxG,qIAAoI,oCAAoC;AACxK;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA,0EAAyE,wBAAwB;AACjG,gEAA+D,mDAAmD;AAClH,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH,eAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,iFAAgF,oCAAoC;AACpH;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA,qFAAoF,oCAAoC;AACxH;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA,iFAAgF,oCAAoC;AACpH;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;;AAEA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA,wCAAuC,oCAAoC;AAC3E;AACA;AACA;AACA,MAAK;AACL,IAAG;AACH;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAO;;AAEP;AACA,MAAK;AACL;AACA;AACA;AACA,IAAG;AACH,EAAC;;AAED;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA,IAAG;AACH;AACA;;AAEA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,2DAA0D,EAAE,MAAM,EAAE,IAAI,IAAI,SAAS,EAAE,YAAY,EAAE,IAAI,IAAI;AAC7G,4BAA2B,kCAAkC;AAC7D;AACA;AACA;AACA;AACA,yDAAwD,EAAE,MAAM,EAAE,IAAI,IAAI,SAAS,EAAE,YAAY,EAAE,IAAI,IAAI;AAC3G,4BAA2B,kCAAkC;AAC7D;AACA;AACA;AACA;AACA,yDAAwD,EAAE,MAAM,EAAE,IAAI,IAAI,SAAS,EAAE,YAAY,EAAE,IAAI,IAAI;AAC3G,4BAA2B,kCAAkC;AAC7D;AACA;AACA;AACA;AACA,yDAAwD,EAAE;AAC1D,4BAA2B,kCAAkC;AAC7D;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,8BAA6B,qIAAqI;AAClK;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oCAAmC;AACnC;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;;AAEH;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW;AACX,UAAS;;AAET;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA,UAAS;;AAET;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,QAAO;AACP,MAAK;AACL;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA,UAAS;;AAET;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA,QAAO;AACP;;AAEA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA,YAAW;AACX;AACA;AACA;AACA;AACA,cAAa;AACb;;AAEA;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;;AAEH;;AAEA;;AAEA,eAAc;AACd;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA,MAAK;AACL;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA,QAAO;;AAEP;AACA;;AAEA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;;AAEb;AACA,YAAW;AACX;AACA;AACA;AACA,gBAAe;AACf;AACA;AACA;AACA,cAAa;;AAEb;AACA;;AAEA;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,YAAW,eAAe;AAC1B,IAAG;AACH;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA,UAAS;;AAET;AACA;;AAEA;AACA;AACA,UAAS;AACT;AACA;;AAEA;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA,MAAK;AACL;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,MAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW,eAAe;AAC1B,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,gBAAe,gCAAgC;AAC/C,QAAO;AACP;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA,UAAS;AACT;AACA;AACA,QAAO;;AAEP;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA,6CAA4C,iCAAiC;AAC7E;AACA;AACA;AACA;AACA,QAAO;;AAEP;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAO;AACP;AACA;;AAEA;;AAEA;AACA;AACA;AACA,QAAO;AACP;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,oGAAmG,EAAE,MAAM,EAAE,IAAI,IAAI,SAAS,EAAE,YAAY,EAAE,IAAI,IAAI;AACtJ,oGAAmG,EAAE;AACrG,mHAAkH,EAAE,MAAM,EAAE,IAAI,IAAI,SAAS,EAAE,YAAY,EAAE,IAAI,IAAI;AACrK,mHAAkH,EAAE,MAAM,EAAE,IAAI,IAAI,SAAS,EAAE,YAAY,EAAE,IAAI,IAAI;AACrK;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,MAAK;AACL;AACA;AACA,IAAG;AACH;;;;;;;AC9lCA,aAAY;;AAEZ;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yPAAwP;AACxP;AACA,MAAK;AACL,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,kBAAiB,iBAAiB;AAClC;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;;;;;;;ACzHA,2G;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA,GAAE;AACF;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;AACA;AACA,SAAQ,sBAAsB;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,eAAc;AACd;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,8BAA6B;AAC7B,8BAA6B;AAC7B,8BAA6B;AAC7B,4BAA2B;AAC3B;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,4DAA2D;AAC3D,8BAA6B,EAAE;AAC/B;;AAEA,UAAS,oBAAoB;AAC7B;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAO;AACP;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;;AAEA;;AAEA;AACA;;AAEA,4BAA2B;AAC3B,EAAC","file":"coupon-rule-edit.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/Users/liuge/Workspace/moviesys/dist/js/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 1c6f78ee17aab47b0daa\n **/","'use strict;'\n\nvar common = require('common');\nvar _budgetSource = [];\nvar _wandaTicket = [];\nvar _movies = [];\nvar _filmType = [\n{ name: '2D' },\n{ name: '3D' },\n];\nvar _screenType = [\n{ name: '普通' },\n{ name: 'IMAX' },\n{ name: 'DMAX' },\n{ name: '巨幕' },\n];\nvar _hallType = [\n{ name: '普通' },\n{ name: '4D' },\n{ name: '5D' },\n];\nvar _channels = [];\nvar _provinces = [];\nvar _submitting = false;\nvar _dimenChanged = false;\nvar _popupDataCache = {\n  channels: [],\n  hallType: ['普通'],\n  filmType: ['2D', '3D'],\n  screenType: ['普通'],\n  films: [],\n  cinemas: [],\n  timetables: [],\n};\n\n$(function () {\n  common.init('coupon-rule');\n\n  setProvince();\n  setBrand();\n\n  var urlParam = common.getUrlParam();\n  if (urlParam.couponId != undefined && urlParam.couponId != '') {\n    setEdit(urlParam.couponId);\n  } else {\n    setWandaTicket(false);\n    setBudgetSource(false);\n    setMovie(false);\n    setDimen(false, false, false, false);\n    setChannel(false);\n  }\n\n  $('#beginDate').datetimepicker({\n    format: 'yyyy-mm-dd',\n    language: 'zh-CN',\n    minView: 2,\n    todayHighlight: true,\n    autoclose: true,\n  }).on('changeDate', function (ev) {\n    var startDate = new Date(ev.date.valueOf());\n    startDate.setDate(startDate.getDate(new Date(ev.date.valueOf())));\n    $('#endDate').datetimepicker('setStartDate', startDate);\n  });\n\n  $('#endDate').datetimepicker({\n    format: 'yyyy-mm-dd',\n    language: 'zh-CN',\n    minView: 2,\n    todayHighlight: true,\n    autoclose: true,\n  }).on('changeDate', function (ev) {\n    var FromEndDate = new Date(ev.date.valueOf());\n    FromEndDate.setDate(FromEndDate.getDate(new Date(ev.date.valueOf())));\n    $('#beginDate').datetimepicker('setEndDate', FromEndDate);\n  });\n\n  $('#movieSelect').multiselect({\n    search: {\n      left: '<input type=\"text\" name=\"q\" class=\"form-control\" placeholder=\"候选...\" />',\n      right: '<input type=\"text\" name=\"q\" class=\"form-control\" placeholder=\"已选...\" />',\n    },\n    right: '#movieSelect_to',\n    rightAll: '#movieSelect_all',\n    rightSelected: '#movieSelect_right',\n    leftSelected: '#movieSelect_left',\n    leftAll: '#movieSelect_none',\n  });\n\n  $('#formEdit').parsley();\n\n  //upper of range\n  window.Parsley.addValidator('ur', {\n    validateString: function (value, requirement) {\n      var $inputs = $('input.parsley-range');\n      var fields = [];\n      $inputs.each(function (index, el) {\n        var ns = $(this).data('parsley-ur');\n        if (ns == requirement) {\n          var value = parseFloat($(el).val());\n          fields.push(value);\n        }\n      });\n\n      if (~~fields[0] == 0 || ~~fields[1] == 0) {\n        return true;\n      } else {\n        return fields[0] < fields[1];\n      }\n    },\n\n    priority: 32,\n    messages: {\n      en: 'This value should be the upper limit of the range.',\n      'zh-cn': '范围的下限与上限设置错误。',\n    },\n  });\n\n});\n\n//成本中心\n$(document).on('change', '#level', function (event) {\n  event.preventDefault();\n  var level = $(this).val();\n  if (level == undefined || level == '') {\n    $('#budgetSource').html('<option value=\"\"></option>');\n  } else {\n    var sources = [];\n    _(_budgetSource).forEach(function (group, key) {\n      if (level == key) {\n        sources = group;\n      }\n    });\n\n    if (sources.length < 1) {\n      $('#budgetSource').html('<option value=\"\"></option>');\n      alert('所选成本中心类别下无成本中心，这个情况不正常，需要注意哦！');\n    } else {\n      var html = '';\n      _(sources).forEach(function (source) {\n        html += '<option value=\"' + source.id + '\">' + source.sourceName + '</option>';\n      });\n\n      $('#budgetSource').html(html);\n      $('#budgetSource').closest('.form-group').show();\n    }\n  }\n});\n\n//上传图片\n$(document).on('click', '#btn-upload', function (event) {\n  event.preventDefault();\n  $('#fileupload').next('span').remove();\n  $('#popup-coupon-image-upload').modal('show');\n  $('#fileupload').data('url', common.API_HOST + 'coupon/uploadImage').fileupload({\n    dataType: 'json',\n    add: function (e, data) {\n      $('#fileupload').next('span').remove();\n      $('#fileupload').after(' <span>' + data.files[0].name + '</span>');\n      $('#popup-coupon-image-upload button.btn-primary').off('click').on('click', function () {\n        $(this).prop('disable', true).text('上传中...');\n        data.submit();\n      });\n    },\n\n    done: function (e, data) {\n      $('#popup-coupon-image-upload button.btn-primary').prop('disable', false).text('上传');\n      if (!!~~data.result.meta.result) {\n        $('#imageUrl').val(data.result.data.savePath);\n        alert('上传成功！');\n        $('#popup-coupon-image-upload').modal('hide');\n      } else {\n        alert('上传失败：' + data.result.meta.msg);\n      }\n    },\n  });\n});\n\n//渠道\n$(document).on('click', '#btn-set-channel', function (event) {\n  event.preventDefault();\n  setChannel(_popupDataCache.channels);\n  var data = { channels: _channels };\n  var template = $('#channel-template').html();\n  Mustache.parse(template);\n  var html = Mustache.render(template, data);\n  $('#popup-unit-channel .modal-body').html(html);\n  $('#popup-unit-channel').modal('show');\n  $('#popup-unit-channel form').parsley();\n});\n\n$(document).on('submit', '#popup-unit-channel form', function (event) {\n  event.preventDefault();\n  _popupDataCache.channels = $('input[name=channels]:checked').map(function () {return ~~$(this).val();}).get();\n  var previewHtml = _popupDataCache.channels.length == _channels.length ? '不限' : $('input[name=channels]:checked').map(function () {return $(this).next('span').text();}).get().join('、');\n  $('#preview-channel').html(previewHtml);\n  $('#popup-unit-channel').modal('hide');\n  return false;\n});\n\n//影片\n$(document).on('click', '#btn-set-movie', function (event) {\n  event.preventDefault();\n  var html = '';\n  var choosedHtml = '';\n  _(_movies).forEach(function (movie) {\n    if (_popupDataCache.films != null && _popupDataCache.films.indexOf(movie.filmId) > -1) {\n      choosedHtml += '<option value=\"' + movie.filmId + '\">' + movie.filmName + '</option>';\n    } else {\n      html += '<option value=\"' + movie.filmId + '\">' + movie.filmName + '</option>';\n    }\n  });\n\n  $('#movieSelect').html(html);\n  $('#movieSelect_to').html(choosedHtml);\n  $('#popup-unit-movie').modal('show');\n});\n\n$(document).on('click', '#popup-unit-movie button[type=submit]', function (event) {\n  $('.multi-selection select:eq(1) option').prop('selected', true);\n});\n\n$(document).on('submit', '#popup-unit-movie form', function (event) {\n  event.preventDefault();\n  var previewHtml = '';\n  if ($('#movieSelect_to option').length > 0) {\n    _popupDataCache.films = $('#movieSelect_to option').map(function () {return ~~$(this).val();}).get();\n    previewHtml = $('#movieSelect_to option').map(function () {return $(this).val() + '[' + $(this).text() + ']';}).get().join(' ');\n  } else {\n    _popupDataCache.films = [];\n    previewHtml = '不限';\n  }\n\n  $('#preview-movie').html(previewHtml);\n  $('#popup-unit-movie').modal('hide');\n  return false;\n});\n\n//制式\n$(document).on('click', '#btn-set-dimen', function (event) {\n  event.preventDefault();\n  _(_filmType).forEach(function (dimen) {\n    dimen.checked = true;\n    if (_popupDataCache.filmType.indexOf(dimen.name) < 0) {\n      dimen.checked = false;\n    }\n  });\n\n  _(_screenType).forEach(function (dimen) {\n    dimen.checked = true;\n    if (_popupDataCache.screenType.indexOf(dimen.name) < 0) {\n      dimen.checked = false;\n    }\n  });\n\n  _(_hallType).forEach(function (dimen) {\n    dimen.checked = true;\n    if (_popupDataCache.hallType.indexOf(dimen.name) < 0) {\n      dimen.checked = false;\n    }\n  });\n\n  var data = { filmType: _filmType, screenType: _screenType, hallType: _hallType };\n  var template = $('#dimen-template').html();\n  Mustache.parse(template);\n  var html = Mustache.render(template, data);\n  $('#popup-unit-dimen .modal-body').html(html);\n  $('#popup-unit-dimen').modal('show');\n  $('#popup-unit-dimen form').parsley();\n});\n\n$(document).on('change', '#popup-unit-dimen input[type=checkbox]', function (event) {\n  event.preventDefault();\n  _dimenChanged = true;\n});\n\n$(document).on('submit', '#popup-unit-dimen form', function (event) {\n  event.preventDefault();\n\n  if (!_dimenChanged) {\n    _dimenChanged = true;\n    if (!window.confirm('已为您默认选择普通厅、普通屏幕、2D3D影片，是否确认保存？')) {\n      return false;\n    }\n  }\n\n  var previewHtmlFilmType = '影片制式：';\n  _popupDataCache.filmType = $('input[name=filmType]:checked').map(function () {return $(this).next('span').text();}).get();\n  if (_popupDataCache.filmType.length == _filmType.length) {\n    previewHtmlFilmType += '不限';\n  } else {\n    previewHtmlFilmType += '[' + _popupDataCache.filmType.join('] [') + ']';\n  }\n\n  var previewHtmlScreenType = '<br>屏幕规格：';\n  _popupDataCache.screenType = $('input[name=screenType]:checked').map(function () {return $(this).next('span').text();}).get();\n  if (_popupDataCache.screenType.length == _screenType.length) {\n    previewHtmlScreenType += '不限';\n  } else {\n    previewHtmlScreenType += '[' + _popupDataCache.screenType.join('] [') + ']';\n  }\n\n  var previewHtmlHallType = '<br>特殊影厅：';\n  _popupDataCache.hallType = $('input[name=hallType]:checked').map(function () {return $(this).next('span').text();}).get();\n  if (_popupDataCache.hallType.length == _hallType.length) {\n    previewHtmlHallType += '不限';\n  } else {\n    previewHtmlHallType += '[' + _popupDataCache.hallType.join('] [') + ']';\n  }\n\n  $('#preview-dimen').html(previewHtmlFilmType + previewHtmlScreenType + previewHtmlHallType);\n  $('#popup-unit-dimen').modal('hide');\n  return false;\n});\n\n//影院\n$(document).on('click', '#btn-set-cinema', function (event) {\n  event.preventDefault();\n  $('#search-cinema-brandId option ,#search-cinema-provinceId option').prop('selected', false);\n  $('#search-cinema-cityId').html('<option value=\"\">城市</option>');\n  $('#search-cinema-candidate tbody, #search-cinema-choosed tbody').html('');\n  $('#input-cinema-filter, #search-cinema-cinemaName').val('');\n  if (_popupDataCache.cinemas != null && _popupDataCache.cinemas.length > 0) {\n    $('#choosedCount').text(_popupDataCache.cinemas.length);\n    var html = '';\n    _(_popupDataCache.cinemas).forEach(function (cinema) {\n      html += '<tr data-id=\"' + cinema.cinemaId + '\"><td>' + cinema.cinemaName + '</td><td>' + cinema.cityName + '</td><td>' + cinema.brandName + '</td></tr>';\n    });\n\n    $('#search-cinema-choosed tbody').html(html);\n    $('#input-cinema-filter').quicksearch('#search-cinema-choosed tbody tr');\n  }\n\n  $('#popup-unit-cinema').modal('show');\n});\n\n$(document).on('change', '#search-cinema-provinceId', function (e) {\n  var provinceId = parseInt($(this).val());\n  var options = '';\n  if (!!+provinceId) {\n    var province = _.find(_provinces, { provinceId: provinceId.toString() });\n    var cityList = province.cityList;\n    _(cityList).forEach(function (value, key) {\n      options += '<option value=\"' + value.cityId + '\">' + value.cityName + '</option>';\n    });\n  } else {\n    options = '<option value=\"\">城市</option>';\n  }\n\n  $('#search-cinema-cityId').html(options);\n  return false;\n});\n\n$(document).on('click', '#btn-search-cinema', function (event) {\n  event.preventDefault();\n  var sendData = {\n    brandId: $('#search-cinema-brandId').val(),\n    cityId: $('#search-cinema-cityId').val(),\n    cinemaName: $.trim($('#search-cinema-cinemaName').val()),\n    associationStatus: 1,\n    onlineStatus: 1,\n    pageIndex: 1,\n    pageSize: 9999,\n  };\n  if (sendData.brandId == '' && sendData.cityId == '') {\n    alert('院线或城市，请至少选择一个！');\n    $('#search-cinema-brandId').focus();\n    return false;\n  }\n\n  $('#search-cinema-candidate tbody').html('<tr><td colspan=\"3\" align=\"center\">查询中，请稍等...</td></tr>');\n  $.ajax({\n    url: common.API_HOST + 'common/cinemas',\n    type: 'POST',\n    dataType: 'json',\n    data: sendData,\n  })\n  .done(function (res) {\n    if (!!~~res.meta.result) {\n      if (res.data.rows.length <= 0) {\n        $('#search-cinema-candidate tbody').html('<tr><td colspan=\"3\" align=\"center\">查不到数据！</td></tr>');\n        return false;\n      }\n\n      var html = '';\n      _(res.data.rows).forEach(function (cinema) {\n        html += '<tr data-id=\"' + cinema.id + '\"><td>' + cinema.name + '</td><td>' + cinema.cityName + '</td><td>' + cinema.brandName + '</td></tr>';\n      });\n\n      $('#search-cinema-candidate tbody').html(html);\n    } else {\n      $('#search-cinema-candidate tbody').html('<tr><td colspan=\"3\" align=\"center\">查不到数据！</td></tr>');\n      alert('接口错误：' + res.meta.msg);\n    }\n  });\n});\n\n$(document).on('click', '#search-cinema-candidate tbody tr, #search-cinema-choosed tbody tr', function (event) {\n  event.preventDefault();\n  $(this).toggleClass('selected');\n});\n\n$(document).on('click', '#search-cinema-add-all', function (event) {\n  event.preventDefault();\n  var choosedIds = [];\n  $('#search-cinema-choosed tbody tr').each(function (index, el) {\n    choosedIds.push($(el).data('id'));\n  });\n\n  $('#search-cinema-candidate tbody tr').each(function (index, el) {\n    if (choosedIds.indexOf($(el).data('id')) == -1) {\n      $(el).clone().appendTo('#search-cinema-choosed tbody').removeClass('selected');\n    }\n  });\n\n  $('#input-cinema-filter').quicksearch('#search-cinema-choosed tbody tr');\n  $('#choosedCount').text($('#search-cinema-choosed tbody tr').length);\n});\n\n$(document).on('click', '#search-cinema-add', function (event) {\n  event.preventDefault();\n  var choosedIds = [];\n  $('#search-cinema-choosed tbody tr').each(function (index, el) {\n    choosedIds.push($(el).data('id'));\n  });\n\n  $('#search-cinema-candidate tbody tr.selected').each(function (index, el) {\n    if (choosedIds.indexOf($(el).data('id')) == -1) {\n      $(el).clone().appendTo('#search-cinema-choosed tbody').removeClass('selected');\n    }\n  });\n\n  $('#input-cinema-filter').quicksearch('#search-cinema-choosed tbody tr');\n  $('#choosedCount').text($('#search-cinema-choosed tbody tr').length);\n});\n\n$(document).on('click', '#search-cinema-remove-all', function (event) {\n  event.preventDefault();\n  $('#search-cinema-choosed tbody tr').remove();\n  $('#input-cinema-filter').quicksearch('#search-cinema-choosed tbody tr');\n  $('#choosedCount').text('0');\n});\n\n$(document).on('click', '#search-cinema-remove', function (event) {\n  event.preventDefault();\n  $('#search-cinema-choosed tbody tr.selected').remove();\n  $('#input-cinema-filter').quicksearch('#search-cinema-choosed tbody tr');\n  $('#choosedCount').text($('#search-cinema-choosed tbody tr').length);\n});\n\n$(document).on('click', '#btn-cinema-filter', function (event) {\n  event.preventDefault();\n  $('#input-cinema-filter').val('');\n  $('#search-cinema-choosed tbody tr').show();\n});\n\n$(document).on('submit', '#popup-unit-cinema form', function (event) {\n  event.preventDefault();\n  _popupDataCache.cinemas = $('#search-cinema-choosed tbody tr').map(function () {\n    var cinema = {\n      cinemaId: $(this).data('id'),\n      cinemaName: $(this).find('td:nth-child(1)').html(),\n      cityName: $(this).find('td:nth-child(2)').html(),\n      brandName: $(this).find('td:nth-child(3)').html(),\n    };\n    return cinema;\n  }).get();\n  var previewHtml = _popupDataCache.cinemas.length > 0 ? '选择了 ' + _popupDataCache.cinemas.length + ' 个影院' : '不限';\n  $('#preview-cinema').html(previewHtml);\n  $('#popup-unit-cinema').modal('hide');\n  return false;\n});\n\n//场次\n$(document).on('click', '#btn-set-timetable', function (event) {\n  event.preventDefault();\n  var html = '';\n  _(_popupDataCache.timetables).forEach(function (time) {\n    html += '<tr><td><input type=\"text\" class=\"form-control beginDate\" required value=\"' + time.beginDate + '\"></td><td><input type=\"text\" class=\"form-control endDate\" required value=\"' + time.endDate + '\"></td><td><input type=\"text\" class=\"form-control beginTime\" required value=\"' + time.beginTime + '\"></td><td><input type=\"text\" class=\"form-control endTime\" required value=\"' + time.endTime + '\"></td><td><button type=\"button\" class=\"btn btn-xs btn-primary btn-delete\">删除</button></td></tr>';\n  });\n\n  $('#timeTable tbody').html(html);\n  resetTimeTable();\n  $('#popup-unit-timetable').modal('show');\n  $('#popup-unit-timetable form').parsley();\n});\n\n$(document).on('click', '#btn-timetable', function (event) {\n  event.preventDefault();\n  var template = $('#timetable-template').html();\n  Mustache.parse(template);\n  var html = Mustache.render(template);\n  $('#timeTable tbody').append(html);\n  $('#popup-unit-timetable').scrollTop($('#popup-unit-timetable').height());\n  resetTimeTable();\n});\n\n$(document).on('click', '#timeTable .btn-delete', function (event) {\n  event.preventDefault();\n  if (window.confirm('确定要删除该条场次限制吗？')) {\n    $(this).closest('tr').remove();\n  }\n});\n\n$(document).on('submit', '#popup-unit-timetable form', function (event) {\n  event.preventDefault();\n  _popupDataCache.timetables = $('#timeTable tbody tr').map(function () {\n    var time = {\n      beginDate: $(this).find('.beginDate').val(),\n      endDate: $(this).find('.endDate').val(),\n      beginTime: $(this).find('.beginTime').val(),\n      endTime: $(this).find('.endTime').val(),\n    };\n    return time;\n  }).get();\n  setTimeTable(_popupDataCache.timetables);\n  var previewHtml = '';\n  if (_popupDataCache.timetables.length > 0) {\n    _(_popupDataCache.timetables).forEach(function (time) {\n      previewHtml += '<p>' + time.beginDate + ' ~ ' + time.endDate + ' 每天 ' + time.beginTime + ' ~ ' + time.endTime + '</p>';\n    });\n\n    $('#preview-timetable').html(previewHtml);\n  } else {\n    $('#preview-timetable').html('不限');\n  }\n\n  $('#popup-unit-timetable').modal('hide');\n  return false;\n});\n\n$(document).on('change', '#couponPattern', function (event) {\n  event.preventDefault();\n  var current = +$(this).val();\n  switch (current) {\n    case 1:\n    case 3:\n      $('#amount').attr('data-parsley-pattern', '^0|[1-9]{1}\\\\d*.{1}\\\\d{1,2}$|^[1-9]{1}\\\\d*$|^[0].{1}\\\\d{1,2}$');\n      $('#limitNum').prop({ disabled: false, required: true });\n      $('#typeTable th:nth-child(3)').text('单张票价区间（最低）');\n      $('#typeTable th:nth-child(4)').text('单张票价区间（最高）');\n    break;\n    case 4:\n      $('#amount').attr('data-parsley-pattern', '^[1-9]{1}\\\\d*.{1}\\\\d{1,2}$|^[1-9]{1}\\\\d*$|^[0].{1}\\\\d{1,2}$');\n      $('#limitNum').prop({ disabled: false, required: true });\n      $('#typeTable th:nth-child(3)').text('单张票价区间（最低）');\n      $('#typeTable th:nth-child(4)').text('单张票价区间（最高）');\n    break;\n    case 2:\n      $('#amount').attr('data-parsley-pattern', '^[1-9]{1}\\\\d*.{1}\\\\d{1,2}$|^[1-9]{1}\\\\d*$|^[0].{1}\\\\d{1,2}$');\n      $('#limitNum').prop({ disabled: true, required: false });\n      $('#typeTable th:nth-child(3)').text('订单价格区间（最低）');\n      $('#typeTable th:nth-child(4)').text('订单价格区间（最高）');\n    break;\n    case 5:\n      $('#amount').attr('data-parsley-pattern', '^[1-9]{1}$');\n      $('#limitNum').prop({ disabled: false, required: true });\n      $('#typeTable th:nth-child(3)').text('单张票价区间（最低）');\n      $('#typeTable th:nth-child(4)').text('单张票价区间（最高）');\n    break;\n  }\n});\n\n//form\n$(document).on('submit', '#formEdit', function (event) {\n  event.preventDefault();\n  if (_submitting) {\n    return false;\n  }\n\n  _submitting = true;\n\n  $('#formUnit input[type=submit]').prop('disabled', true).text('更新中...');\n\n  var sendData = {\n    name: $.trim($('#name').val()),\n    signNo: $.trim($('#signNo').val()),\n    budgetSource: $('#budgetSource').val(),\n    beginDate: $('#beginDate').val(),\n    endDate: $('#endDate').val(),\n    budgetSource: $('#budgetSource').val(),\n    wandaTicketId: $('#wandaTicketId').val(),\n    advancePayment: $('input[name=advancePayment]:checked').val(),\n    couponDesc: $.trim($('#couponDesc').val()),\n    imageUrl: $.trim($('#imageUrl').val()),\n    maxInventory: $.trim($('#maxInventory').val()),\n    channels: _popupDataCache.channels,\n    hallType: _popupDataCache.hallType,\n    filmType: _popupDataCache.filmType,\n    screenType: _popupDataCache.screenType,\n    couponPattern: $('#couponPattern').val(),\n    patternList: [],\n    films: _popupDataCache.films,\n    cinemas: [],\n    timetables: _popupDataCache.timetables,\n  };\n\n  sendData.patternList.push({ amount: $('#amount').val(), limitNum: $('#limitNum').val(), lowerBound: $('#lowerBound').val(), upperBound: $('#upperBound').val() });\n  _(_popupDataCache.cinemas).forEach(function (cinema) {\n    sendData.cinemas.push(cinema.cinemaId);\n  });\n\n  var ajaxUrl = 'coupon/couponSave';\n  if ($('#id').size() > 0) {\n    ajaxUrl = 'coupon/couponUpdate';\n    sendData.id = $('#id').val();\n  }\n\n  $.ajax({\n    url: common.API_HOST + ajaxUrl,\n    type: 'POST',\n    dataType: 'json',\n    contentType: 'application/json; charset=utf-8',\n    data: JSON.stringify(sendData),\n  })\n  .done(function (res) {\n    _submitting = false;\n    $('#formUnit input[type=submit]').prop('disabled', false).text('保存');\n    if (!!~~res.meta.result) {\n      if (ajaxUrl == 'coupon/couponUpdate') {\n        alert('更新成功！');\n        document.location.reload(true);\n      } else {\n        alert('保存成功！');\n        document.location = 'coupon-rule.html';\n      }\n    } else {\n      alert('接口错误：' + res.meta.msg);\n    }\n  });\n\n  return false;\n});\n\n//数据缓存\nfunction setBudgetSource(budgetSourceId) {\n  $.ajax({\n    url: common.API_HOST + 'activity/budgetSourceList',\n    type: 'POST',\n    dataType: 'json',\n  })\n  .done(function (res) {\n    if (!!~~res.meta.result) {\n      _budgetSource = res.data;\n      if (!!~~budgetSourceId) {\n        var html = '';\n        var levelId = 0;\n        _(_budgetSource).forEach(function (group, key) {\n          _(group).forEach(function (source) {\n            if (budgetSourceId == source.id) {\n              levelId = parseInt(key);\n            }\n          });\n        });\n\n        $('#level option').eq(1 + levelId).prop('selected', true);\n        _(_budgetSource[levelId]).forEach(function (source) {\n          if (budgetSourceId == source.id) {\n            html += '<option value=\"' + source.id + '\" selected>' + source.sourceName + '</option>';\n          } else {\n            html += '<option value=\"' + source.id + '\">' + source.sourceName + '</option>';\n          }\n        });\n\n        $('#budgetSource').html(html);\n      }\n    } else {\n      alert('接口错误：' + res.meta.msg);\n    }\n  });\n}\n\nfunction setBrand() {\n  $.ajax({\n    url: common.API_HOST + 'common/brandList',\n    type: 'GET',\n    dataType: 'json',\n  })\n  .done(function (res) {\n    if (!!~~res.meta.result) {\n      _(res.data).forEach(function (brand) {\n        $('#search-cinema-brandId').append($('<option></option>').attr('value', brand.id).text(brand.name));\n      });\n    } else {\n      alert('接口错误：' + res.meta.msg);\n    }\n  });\n}\n\nfunction setWandaTicket(wandaTicketId) {\n  $.ajax({\n    url: common.API_HOST + 'activity/wandaActivityTicketList',\n    type: 'GET',\n    dataType: 'json',\n  })\n  .done(function (res) {\n    if (!!~~res.meta.result) {\n      if (res.data == null || res.data.wandaTicketList.length < 1) {\n        return false;\n      } else {\n        _wandaTicket = res.data.wandaTicketList;\n        var html = '';\n        _(_wandaTicket).forEach(function (ticket) {\n          if (wandaTicketId == ticket.id) {\n            html += '<option value=\"' + ticket.id + '\" selected>' + ticket.ticketId + '</option>';\n          } else {\n            html += '<option value=\"' + ticket.id + '\">' + ticket.ticketId + '</option>';\n          }\n        });\n\n        $('#wandaTicketId').append(html);\n      }\n    } else {\n      alert('接口错误：' + res.meta.msg);\n    }\n  });\n}\n\nfunction setMovie(films) {\n  var previewHtml = '';\n  if (_movies.length > 0) {\n    if (films == false) {\n      previewHtml = '不限';\n    } else {\n      _(_movies).forEach(function (movie) {\n        if (films.indexOf(movie.filmId) > -1) {\n          previewHtml += movie.filmId + '[' + movie.filmName + '] ';\n        }\n      });\n    }\n\n    $('#preview-movie').html(previewHtml);\n  } else {\n    $.ajax({\n      url: common.API_HOST + 'common/filmList',\n      type: 'GET',\n      dataType: 'json',\n    })\n    .done(function (res) {\n      if (!!~~res.meta.result) {\n        if (res.data == null || res.data.length < 1) {\n          return false;\n        } else {\n          _movies = res.data;\n          if (films == false) {\n            previewHtml = '不限';\n          } else {\n            _(_movies).forEach(function (movie) {\n              if (films.indexOf(movie.filmId) > -1) {\n                previewHtml += movie.filmId + '[' + movie.filmName + '] ';\n              }\n            });\n          }\n\n          $('#preview-movie').html(previewHtml);\n        }\n      } else {\n        alert('接口错误：' + res.meta.msg);\n      }\n    });\n  }\n}\n\nfunction setDimen(actionEdit, checkedHallType, checkedFilmType, checkedScreenType) {\n\n  if (!actionEdit) {\n    checkedHallType = ['普通'];\n    checkedFilmType = ['2D', '3D'];\n    checkedScreenType = ['普通'];\n  }\n\n  var previewHtmlFilmType = '影片制式：';\n  _(_filmType).forEach(function (dimen) {\n    dimen.checked = true;\n    if (checkedFilmType != false && checkedFilmType.indexOf(dimen.name) < 0) {\n      dimen.checked = false;\n    } else {\n      previewHtmlFilmType += '[' + dimen.name +  '] ';\n    }\n  });\n\n  var previewHtmlScreenType = '<br>屏幕规格：';\n  _(_screenType).forEach(function (dimen) {\n    dimen.checked = true;\n    if (checkedScreenType != false && checkedScreenType.indexOf(dimen.name) < 0) {\n      dimen.checked = false;\n    } else {\n      previewHtmlScreenType += '[' + dimen.name + '] ';\n    }\n  });\n\n  var previewHtmlHallType = '<br>特殊影厅：';\n  _(_hallType).forEach(function (dimen) {\n    dimen.checked = true;\n    if (checkedHallType != false && checkedHallType.indexOf(dimen.name) < 0) {\n      dimen.checked = false;\n    } else {\n      previewHtmlHallType += '[' + dimen.name + '] ';\n    }\n  });\n\n  var previewHtml = previewHtmlFilmType + previewHtmlScreenType + previewHtmlHallType;\n\n  $('#preview-dimen').html(previewHtml);\n\n  var data = { filmType: _filmType, screenType: _screenType, hallType: _hallType };\n  var template = $('#dimen-template').html();\n  Mustache.parse(template);\n  var html = Mustache.render(template, data);\n  $('#popup-unit-dimen .modal-body').html(html);\n}\n\nfunction setChannel(channels) {\n  var previewHtml = '';\n  var checkedChannelNames = [];\n  if (_channels.length > 0) {\n    if (channels == false || _channels.length == channels.length) {\n      _popupDataCache.channels = [];\n      _(_channels).forEach(function (channel) {\n        _popupDataCache.channels.push(channel.channelId);\n        channel.checked = true;\n      });\n\n      previewHtml = '不限';\n    } else {\n      _(_channels).forEach(function (channel) {\n        if (channels.indexOf(channel.channelId.toString()) < 0) {\n          channel.checked = false;\n        } else {\n          channel.checked = true;\n          checkedChannelNames.push(channel.channelName);\n        }\n      });\n\n      previewHtml = checkedChannelNames.join('、');\n    }\n\n    $('#preview-channel').html(previewHtml);\n  } else {\n    $.ajax({\n      url: common.API_HOST + 'common/channelList',\n      type: 'GET',\n      dataType: 'json',\n    })\n    .done(function (res) {\n      if (!!~~res.meta.result) {\n        if (res.data == null || res.data.length < 1) {\n          return false;\n        } else {\n          _channels = res.data;\n          if (channels == false || _channels.length == channels.length) {\n            _popupDataCache.channels = [];\n            _(_channels).forEach(function (channel) {\n              _popupDataCache.channels.push(channel.channelId);\n              channel.checked = true;\n            });\n\n            previewHtml = '不限';\n          } else {\n            _(_channels).forEach(function (channel) {\n              if (channels.indexOf(channel.channelId.toString()) < 0) {\n                channel.checked = false;\n              } else {\n                channel.checked = true;\n                checkedChannelNames.push(channel.channelName);\n              }\n            });\n\n            previewHtml = checkedChannelNames.join('、');\n          }\n\n          $('#preview-channel').html(previewHtml);\n        }\n      } else {\n        alert('接口错误：' + res.meta.msg);\n      }\n    });\n  }\n}\n\nfunction setCinema(cinemas) {\n  $.ajax({\n    url: common.API_HOST + 'common/getCinemasByIds',\n    type: 'POST',\n    dataType: 'json',\n    data: { ids: cinemas },\n  })\n  .done(function (res) {\n    if (!!~~res.meta.result) {\n      if (res.data == null || res.data.length < 1) {\n        return false;\n      } else {\n        var html = '';\n        var previewHtml = '';\n        _(res.data).forEach(function (cinema) {\n          html += '<tr data-id=\"' + cinema.cinemaId + '\"><td>' + cinema.cinemaName + '</td><td>' + cinema.cityName + '</td><td>' + cinema.brandName + '</td></tr>';\n        });\n\n        $('#search-cinema-choosed tbody').html(html);\n        $('#input-cinema-filter').quicksearch('#search-cinema-choosed tbody tr');\n\n        if (res.data.length > 0) {\n          previewHtml = '选择了 ' + res.data.length + ' 个影院';\n        } else {\n          previewHtml = '不限';\n        }\n\n        $('#preview-cinema').html(previewHtml);\n      }\n    } else {\n      alert('接口错误：' + res.meta.msg);\n    }\n  });\n}\n\nfunction setProvince() {\n  $.ajax({\n    url: common.API_HOST + 'common/provinceList',\n    type: 'GET',\n    dataType: 'json',\n  })\n  .done(function (res) {\n    if (!!~~res.meta.result) {\n      _provinces = res.data;\n      var html = '';\n      _(_provinces).forEach(function (province) {\n        html += '<option value=\"' + province.provinceId + '\">' + province.provinceName + '</option>';\n      });\n\n      $('#search-cinema-provinceId').append(html);\n    } else {\n      alert('接口错误：' + res.meta.msg);\n    }\n  });\n}\n\nfunction setTimeTable(timetables) {\n  var previewHtml = '';\n  if (timetables == false || timetables == null || timetables.length == 0) {\n    previewHtml = '不限';\n  } else {\n    _(timetables).forEach(function (time) {\n      previewHtml += '<p>' + time.beginDate + ' ~ ' + time.endDate + ' 每天 ' + time.beginTime + ' ~ ' + time.endTime + '</p>';\n    });\n  }\n\n  $('#preview-timetable').html(previewHtml);\n}\n\nfunction resetTimeTable() {\n  $('.beginDate').datetimepicker({\n    format: 'yyyy-mm-dd',\n    language: 'zh-CN',\n    minView: 2,\n    todayHighlight: true,\n    autoclose: true,\n  }).on('changeDate', function (ev) {\n    var startDate = new Date(ev.date.valueOf());\n    startDate.setDate(startDate.getDate(new Date(ev.date.valueOf())));\n    $(this).closest('tr').find('.endDate').datetimepicker('setStartDate', startDate);\n  });\n\n  $('.endDate').datetimepicker({\n    format: 'yyyy-mm-dd',\n    language: 'zh-CN',\n    minView: 2,\n    todayHighlight: true,\n    autoclose: true,\n  }).on('changeDate', function (ev) {\n    var FromEndDate = new Date(ev.date.valueOf());\n    FromEndDate.setDate(FromEndDate.getDate(new Date(ev.date.valueOf())));\n    $(this).closest('tr').find('.beginDate').datetimepicker('setEndDate', FromEndDate);\n  });\n\n  $('.beginTime').datetimepicker({\n    format: 'hh:ii',\n    language: 'zh-CN',\n    startView: 1,\n    autoclose: true,\n  }).on('changeDate', function (ev) {\n    var startDate = new Date(ev.date.valueOf());\n    startDate.setDate(startDate.getDate(new Date(ev.date.valueOf())));\n    $(this).closest('tr').find('.endTime').datetimepicker('setStartDate', startDate);\n  });\n\n  $('.endTime').datetimepicker({\n    format: 'hh:ii',\n    language: 'zh-CN',\n    startView: 1,\n    autoclose: true,\n  }).on('changeDate', function (ev) {\n    var FromEndDate = new Date(ev.date.valueOf());\n    FromEndDate.setDate(FromEndDate.getDate(new Date(ev.date.valueOf())));\n    $(this).closest('tr').find('.beginTime').datetimepicker('setEndDate', FromEndDate);\n  });\n}\n\nfunction setEdit(couponId) {\n  $('h3').text('编辑优惠券:' + couponId);\n  $.ajax({\n    url: common.API_HOST + 'coupon/couponDetail',\n    type: 'POST',\n    dataType: 'json',\n    data: { id: couponId },\n  })\n  .done(function (res) {\n    if (!!~~res.meta.result) {\n      var coupon = res.data;\n      _popupDataCache.channels = coupon.channels != null ? coupon.channels : [];\n      _popupDataCache.films = coupon.films != null ? coupon.films : [];\n      _popupDataCache.filmType = coupon.filmType != null ? coupon.filmType : ['2D', '3D'];\n      _popupDataCache.screenType = coupon.screenType != null ? coupon.screenType : ['普通', 'IMAX', 'DMAX', '巨幕'];\n      _popupDataCache.hallType = coupon.hallType != null ? coupon.hallType : ['普通', '4D', '5D'];\n      _popupDataCache.timetables = coupon.timetables != null ? coupon.timetables : [];\n\n      coupon.cinemas = coupon.cinemas != null ? coupon.cinemas : [];\n      $.ajax({\n        url: common.API_HOST + 'common/getCinemasByIds',\n        type: 'POST',\n        dataType: 'json',\n        data: { ids: coupon.cinemas.join('|') },\n      })\n      .done(function (res) {\n        if (!!~~res.meta.result) {\n          if (res.data == null || res.data.length < 1) {\n            return false;\n          } else {\n            _popupDataCache.cinemas = res.data;\n          }\n        } else {\n          alert('接口错误：' + res.meta.msg);\n        }\n      });\n\n      if (coupon == null || coupon == undefined) {\n        alert('无法获取要编辑的活动单元信息，这个不太正常，让[猴子们]来查一查！');\n        return false;\n      }\n\n      $('#formEdit').prepend('<input type=\"hidden\" id=\"id\" value=\"' + coupon.id + '\">');\n\n      $('#name').val(coupon.name).prop('disabled', true);;\n      $('#signNo').val(coupon.signNo).prop('disabled', true);;\n      $('#beginDate').val(coupon.beginDate.split(' ')[0]);\n      $('#endDate').val(coupon.endDate.split(' ')[0]);\n\n      $('input[name=advancePayment]').prop({ disabled: true, checked: false });\n      $('input[name=advancePayment]').each(function (index, el) {\n        if ($(el).val() == coupon.advancePayment) {\n          $(el).prop('checked', true);\n        }\n      });\n\n      $('#couponDesc').val(coupon.couponDesc);\n      $('#imageUrl').val(coupon.imageUrl);\n      $('#maxInventory').val(coupon.maxInventory);\n\n      //成本中心\n      if (coupon.budgetSource != '' && coupon.budgetSource != null && coupon.budgetSource != undefined) {\n        setBudgetSource(coupon.budgetSource);\n      } else {\n        setBudgetSource(false);\n      }\n\n      $('#level,#budgetSource').prop('disabled', true);\n\n      //万达票类\n      if (coupon.wandaTicketId != '' && coupon.wandaTicketId != null && coupon.wandaTicketId != undefined) {\n        setWandaTicket(coupon.wandaTicketId);\n      } else {\n        setWandaTicket(false);\n      }\n\n      $('#wandaTicketId').prop('disabled', true);\n\n      //活动形式\n      $('#couponPattern option').eq(coupon.couponPattern - 1).prop('selected', true);\n      if (coupon.couponPattern != null) {\n        coupon.patternList[0].lowerBound = ~~coupon.patternList[0].lowerBound < 1 ? '' : coupon.patternList[0].lowerBound;\n        coupon.patternList[0].upperBound = ~~coupon.patternList[0].upperBound < 1 ? '' : coupon.patternList[0].upperBound;\n        var htmlPattern = '<tr>';\n        htmlPattern += '<td><input type=\"text\" id=\"amount\" required data-parsley-pattern=\"^0|[1-9]{1}\\\\d*.{1}\\\\d{1,2}$|^[1-9]{1}\\\\d*$|^[0].{1}\\\\d{1,2}$\" placeholder=\"必填\" value=\"' + coupon.patternList[0].amount + '\"></td>';\n        htmlPattern += '<td><input type=\"text\" id=\"limitNum\" required data-parsley-pattern=\"^[1-9]{1}\\\\d*$\" placeholder=\"必填\" value=\"' + coupon.patternList[0].limitNum + '\"></td>';\n        htmlPattern += '<td><input type=\"text\" id=\"lowerBound\" class=\"parsley-range\" data-parsley-pattern=\"^[1-9]{1}\\\\d*.{1}\\\\d{1,2}$|^[1-9]{1}\\\\d*$|^[0].{1}\\\\d{1,2}$\" data-parsley-ur=\"0\" placeholder=\"不限\" value=\"' + coupon.patternList[0].lowerBound + '\"></td>';\n        htmlPattern += '<td><input type=\"text\" id=\"upperBound\" class=\"parsley-range\" data-parsley-pattern=\"^[1-9]{1}\\\\d*.{1}\\\\d{1,2}$|^[1-9]{1}\\\\d*$|^[0].{1}\\\\d{1,2}$\" data-parsley-ur=\"0\" placeholder=\"不限\" value=\"' + coupon.patternList[0].upperBound + '\"></td>';\n        htmlPattern += '</tr>';\n        $('#typeTable tbody').html(htmlPattern);\n        $('#couponPattern').trigger('change');\n      }\n\n      //渠道\n      if (coupon.channels != null && coupon.channels.length > 0) {\n        setChannel(coupon.channels)\n      } else {\n        setChannel(false);\n      }\n\n      //影片\n      coupon.films != null && coupon.films.length > 0 ? setMovie(coupon.films) : setMovie(false);\n\n      //制式\n      if (coupon.filmType == null && coupon.screenType == null && coupon.hallType == null) {\n        $('#preview-dimen').html('不限');\n      } else {\n        var previewHtmlFilmType = coupon.filmType.length == _filmType.length ? '影片制式：不限' : '影片制式：[' + coupon.filmType.join('] [') + ']';\n        var previewHtmlScreenType = '<br>屏幕规格：[' + coupon.screenType.join('] [') + ']';\n        var previewHtmlHallType = '<br>特殊影厅：[' + coupon.hallType.join('] [') + ']';\n        $('#preview-dimen').html(previewHtmlFilmType + previewHtmlScreenType + previewHtmlHallType);\n      }\n\n      //影院\n      $('#preview-cinema').html(coupon.cinemas != null && coupon.cinemas.length > 0 ? '选择了 ' + coupon.cinemas.length + ' 个影院' : '不限');\n\n      //场次\n      setTimeTable(coupon.timetables);\n    } else {\n      alert('接口错误：' + res.meta.msg);\n    }\n  });\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/js/coupon-rule-edit.js\n ** module id = 0\n ** module chunks = 25\n **/","'use strict;'\n\nrequire('cookie');\nvar common = {};\n\ncommon.API_HOST = window.location.protocol + '//' + window.location.host + '/MovieOps/';\n\ncommon.init = function (pageName) {\n  common.checkLogin();\n  common.showMenu(pageName);\n  common.setLoginName();\n\n  $.ajaxSetup({\n    error: function (jqXHR, textStatus, errorThrown) {\n      var errorMsg = jqXHR.status + '：未知错误！';\n      var redirectUrl = document.location.href;\n      switch (jqXHR.status){\n        case (500):\n          errorMsg = jqXHR.status + '：服务器无响应，请稍后再试！';\n        break;\n        case (401):\n          errorMsg = jqXHR.status + '：未登录或登陆超时，请尝试重新登陆！';\n          redirectUrl = 'login.html?logout';\n        break;\n        case (403):\n          errorMsg = jqXHR.status + '：没有权限，请尝试重新登陆！';\n          redirectUrl = 'login.html?logout';\n        break;\n        case (404):\n          errorMsg = jqXHR.status + '：服务器暂时无法访问，请稍后再试！';\n        break;\n        case (408):\n          errorMsg = jqXHR.status + '：请求超时，请稍后再试！';\n        break;\n        case (0):\n          errorMsg = jqXHR.status + '：貌似断网了！';\n        break;\n      }\n      $('<div class=\"modal fade\" data-keyboard=\"false\" data-backdrop=\"static\"><div class=\"modal-dialog\"><div class=\"modal-content\"><div class=\"modal-header\"><h4 class=\"modal-title\">错误提示</h4></div><div class=\"modal-body\"><p style=\"text-align:center;\">' + errorMsg + '</p></div><div class=\"modal-footer\"><a href=\"' + redirectUrl + '\" class=\"btn btn-primary\">确定</a></div></div></div></div>').appendTo('body').modal('show');\n      throw new Error('Abort, error ' + jqXHR.status);\n    },\n  });\n};\n\ncommon.showMenu = function (pageName) {\n  var allowMenus = sessionStorage.getItem('menuAuthority') != null ? sessionStorage.getItem('menuAuthority').split(',') : null;\n  if (pageName != undefined && pageName != '' && $('#menu-' + pageName).size() > 0) {\n    var menuId = '' + $('#menu-' + pageName).data('id');\n    if (allowMenus.indexOf(menuId) < 0) {\n      common.logout();\n      window.location.href = 'login.html';\n    }\n\n    $('#menu-' + pageName).addClass('active').closest('.panel-collapse').collapse('show');\n\n  }\n\n  var $menus = $('#menu .list-group-item');\n  $menus.each(function (index, el) {\n    menuId = '' + $(el).data('id');\n    if (allowMenus.indexOf(menuId) > -1) {\n      $(el).show();\n      $(el).closest('.panel').show();\n    }\n  });\n};\n\ncommon.checkLogin = function () {\n  if (sessionStorage.getItem('menuAuthority') == null || Cookies.get('Xtoken') == undefined) {\n    common.logout();\n    window.location.href = 'login.html';\n  }\n};\n\ncommon.setLoginName = function () {\n  var loginName = Cookies.get('name');\n  if (loginName != undefined && loginName != '') {\n    $('#loginName').text(loginName);\n  }\n};\n\ncommon.logout = function () {\n  Cookies.remove('Xtoken');\n  Cookies.remove('name');\n  sessionStorage.setItem('cityAuthority', '');\n  sessionStorage.setItem('channelAuthority', '');\n  sessionStorage.setItem('menuAuthority', '');\n};\n\ncommon.getDate = function (date) {\n  if (date == undefined || date == '') {\n    date = new Date();\n  }\n\n  var YYYY = date.getFullYear().toString();\n  var MM = (date.getMonth() + 1).toString();\n  var DD = date.getDate().toString();\n  MM = MM[1] ? MM : '0' + MM[0];\n  DD = DD[1] ? DD : '0' + DD[0];\n  return YYYY + '-' + MM + '-' + DD;\n};\n\ncommon.getUrlParam = function () {\n  var paramArr = {};\n  var query = window.location.search.substring(1);\n  var vars = query.split('&');\n  for (var i = 0; i < vars.length; i++) {\n    var pair = vars[i].split(/=(.+)?/);\n    if (typeof paramArr[pair[0]] === 'undefined') {\n      paramArr[pair[0]] = decodeURIComponent(pair[1]);\n    } else if (typeof paramArr[pair[0]] === 'string') {\n      var arr = [paramArr[pair[0]], decodeURIComponent(pair[1])];\n      paramArr[pair[0]] = arr;\n    } else {\n      paramArr[pair[0]].push(decodeURIComponent(pair[1]));\n    }\n  }\n\n  return paramArr;\n};\n\nmodule.exports = common;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/common/common.js\n ** module id = 1\n ** module chunks = 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46\n **/","module.exports = global[\"Cookies\"] = require(\"-!/Users/liuge/Workspace/moviesys/bower_components/js-cookie/src/js.cookie.js\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./bower_components/js-cookie/src/js.cookie.js\n ** module id = 2\n ** module chunks = 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46\n **/","/*!\n * JavaScript Cookie v2.1.1\n * https://github.com/js-cookie/js-cookie\n *\n * Copyright 2006, 2015 Klaus Hartl & Fagner Brack\n * Released under the MIT license\n */\n;(function (factory) {\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(factory);\n\t} else if (typeof exports === 'object') {\n\t\tmodule.exports = factory();\n\t} else {\n\t\tvar OldCookies = window.Cookies;\n\t\tvar api = window.Cookies = factory();\n\t\tapi.noConflict = function () {\n\t\t\twindow.Cookies = OldCookies;\n\t\t\treturn api;\n\t\t};\n\t}\n}(function () {\n\tfunction extend () {\n\t\tvar i = 0;\n\t\tvar result = {};\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tvar attributes = arguments[ i ];\n\t\t\tfor (var key in attributes) {\n\t\t\t\tresult[key] = attributes[key];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction init (converter) {\n\t\tfunction api (key, value, attributes) {\n\t\t\tvar result;\n\t\t\tif (typeof document === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Write\n\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tattributes = extend({\n\t\t\t\t\tpath: '/'\n\t\t\t\t}, api.defaults, attributes);\n\n\t\t\t\tif (typeof attributes.expires === 'number') {\n\t\t\t\t\tvar expires = new Date();\n\t\t\t\t\texpires.setMilliseconds(expires.getMilliseconds() + attributes.expires * 864e+5);\n\t\t\t\t\tattributes.expires = expires;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tresult = JSON.stringify(value);\n\t\t\t\t\tif (/^[\\{\\[]/.test(result)) {\n\t\t\t\t\t\tvalue = result;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\n\t\t\t\tif (!converter.write) {\n\t\t\t\t\tvalue = encodeURIComponent(String(value))\n\t\t\t\t\t\t.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = converter.write(value, key);\n\t\t\t\t}\n\n\t\t\t\tkey = encodeURIComponent(String(key));\n\t\t\t\tkey = key.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent);\n\t\t\t\tkey = key.replace(/[\\(\\)]/g, escape);\n\n\t\t\t\treturn (document.cookie = [\n\t\t\t\t\tkey, '=', value,\n\t\t\t\t\tattributes.expires && '; expires=' + attributes.expires.toUTCString(), // use expires attribute, max-age is not supported by IE\n\t\t\t\t\tattributes.path    && '; path=' + attributes.path,\n\t\t\t\t\tattributes.domain  && '; domain=' + attributes.domain,\n\t\t\t\t\tattributes.secure ? '; secure' : ''\n\t\t\t\t].join(''));\n\t\t\t}\n\n\t\t\t// Read\n\n\t\t\tif (!key) {\n\t\t\t\tresult = {};\n\t\t\t}\n\n\t\t\t// To prevent the for loop in the first place assign an empty array\n\t\t\t// in case there are no cookies at all. Also prevents odd result when\n\t\t\t// calling \"get()\"\n\t\t\tvar cookies = document.cookie ? document.cookie.split('; ') : [];\n\t\t\tvar rdecode = /(%[0-9A-Z]{2})+/g;\n\t\t\tvar i = 0;\n\n\t\t\tfor (; i < cookies.length; i++) {\n\t\t\t\tvar parts = cookies[i].split('=');\n\t\t\t\tvar name = parts[0].replace(rdecode, decodeURIComponent);\n\t\t\t\tvar cookie = parts.slice(1).join('=');\n\n\t\t\t\tif (cookie.charAt(0) === '\"') {\n\t\t\t\t\tcookie = cookie.slice(1, -1);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tcookie = converter.read ?\n\t\t\t\t\t\tconverter.read(cookie, name) : converter(cookie, name) ||\n\t\t\t\t\t\tcookie.replace(rdecode, decodeURIComponent);\n\n\t\t\t\t\tif (this.json) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcookie = JSON.parse(cookie);\n\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === name) {\n\t\t\t\t\t\tresult = cookie;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!key) {\n\t\t\t\t\t\tresult[name] = cookie;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tapi.set = api;\n\t\tapi.get = function (key) {\n\t\t\treturn api(key);\n\t\t};\n\t\tapi.getJSON = function () {\n\t\t\treturn api.apply({\n\t\t\t\tjson: true\n\t\t\t}, [].slice.call(arguments));\n\t\t};\n\t\tapi.defaults = {};\n\n\t\tapi.remove = function (key, attributes) {\n\t\t\tapi(key, '', extend(attributes, {\n\t\t\t\texpires: -1\n\t\t\t}));\n\t\t};\n\n\t\tapi.withConverter = init;\n\n\t\treturn api;\n\t}\n\n\treturn init(function () {});\n}));\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./bower_components/js-cookie/src/js.cookie.js\n ** module id = 3\n ** module chunks = 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46\n **/"],"sourceRoot":""}